# .github/workflows/repo-file-sync.yaml
name: Repo File Sync

on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 3 * * MON-FRI" # Run workflow at 12:00 JST every MON-FRI
permissions:
  contents: write
jobs:
  sync:
    runs-on: ubuntu-latest
    env:
      SETTINGS: |
        [
          {
            "owner": "kagankan",
            "repo": "sync-test-b",
            "paths": [
              "README.md",
              ".eslintrc",
              "test/*.md"
            ]
          },
          {
            "owner": "kagankan",
            "repo": "sync-test-c",
            "paths": [
              "README.md"
            ]
          }
        ]
    steps:
      - uses: actions/checkout@v4

      - name: Loop through SETTINGS
        run: |
          # SETTINGS を JSON としてパース
          settings=$(echo "$SETTINGS" | jq -c '.[]')
          echo $settings
          # ループ処理
          echo "$settings" | while IFS= read -r setting; do
            owner=$(echo "$setting" | jq -r '.owner')
            repo=$(echo "$setting" | jq -r '.repo')
            paths=$(echo "$setting" | jq -r '.paths[]')

            echo "Processing $owner/$repo with paths:"
            for path in $paths; do
              echo "- $path"
            done
          done
